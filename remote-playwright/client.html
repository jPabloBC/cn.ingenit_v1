<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Playwright Stream Client</title>
    <style>
      body{font-family:Arial,Helvetica,sans-serif;padding:12px}
      #screen{width:100%;max-width:1280px;border:1px solid #ccc;background:#000}
      input[type=text]{width:60%}
      button{margin-left:6px}
    </style>
  </head>
  <body>
    <div>
      <input id="url" type="text" placeholder="https://example.com" />
      <button id="go">Ir</button>
      <button id="back">Atr√°s</button>
      <button id="forward">Adelante</button>
      <button id="reload">Recargar</button>
    </div>
    <div style="margin-top:8px">
      <canvas id="screen" width="1280" height="720"></canvas>
    </div>

    <script>
      const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:'
      const ws = new WebSocket(protocol + '//' + location.host)
      const canvas = document.getElementById('screen')
      const ctx = canvas.getContext('2d')
      const urlIn = document.getElementById('url')
      const go = document.getElementById('go')
      const back = document.getElementById('back')
      const forward = document.getElementById('forward')
      const reload = document.getElementById('reload')

      ws.addEventListener('open', () => console.log('ws open'))
      ws.addEventListener('message', async (ev) => {
        try {
          const data = JSON.parse(ev.data)
          if (data.type === 'frame') {
            const b64 = data.image
            const blob = await (await fetch('data:image/png;base64,' + b64)).blob()
            const img = await createImageBitmap(blob)
            canvas.width = img.width
            canvas.height = img.height
            ctx.drawImage(img, 0, 0)
          }
        } catch (e) {
          console.error(e)
        }
      })

      go.addEventListener('click', () => {
        const v = urlIn.value.trim()
        if (!v) return
        ws.send(JSON.stringify({ type: 'goto', url: v }))
      })
      back.addEventListener('click', () => ws.send(JSON.stringify({ type: 'back' })))
      forward.addEventListener('click', () => ws.send(JSON.stringify({ type: 'forward' })))
      reload.addEventListener('click', () => ws.send(JSON.stringify({ type: 'reload' })))

      urlIn.value = 'https://example.com'
      setTimeout(()=>go.click(), 400)
    </script>
  </body>
</html>
